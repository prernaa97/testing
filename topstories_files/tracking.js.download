$(document).ready(function(){
  var page = $("data#mix-panel-data").attr('data-page-name');
  var pageType = $("data#mix-panel-data").attr('data-page-type');
  var mixPanelData = {};

  if(pageType == 'Homepage'){
    mixPanelData.page = "bbHomePage";
    mixPanelData.page_type = "beautyBookPage";
    
    doTracking('blog_home_page_loads', mixPanelData);
  }else if(pageType == 'Articlepage'){
    mixPanelData.page = "bbArticlePage";
    mixPanelData.page_type = "beautyBookPage";
    mixPanelData.category_l1 = $("data#mix-panel-data").attr('data-category-l1');
    mixPanelData.category_l2 = $("data#mix-panel-data").attr('data-category-l2');
    mixPanelData.article_id = $("data#mix-panel-data").attr('data-post-id');
    mixPanelData.article_title = $("data#mix-panel-data").attr('data-post-title');

    doTracking('blog_article_page_loads', mixPanelData);
  }

  // Subscribe Click
  $(document).on('click', '#btn-subsribe-newsletter', function(e){
    doTracking('blog_subscribe', {});
    e.preventDefault();
  });
  
  // Share Button Tracking
  $(document).on('click', '.share-menu-option', function(e){
    var articleTitle = $(this).attr('data-title');
    var articleID = $(this).attr('data-id');
    doTracking('blog_share', {'article_title':articleTitle, 'article_id': articleID});
    e.preventDefault();
  });

  // Search Tracking Desktop
  $(document).on('keyup', '#desktop-search-text-box', function(e){
    //var query = $(this).val();
    //doTracking('blog_search_executed', {'bb_keyword_searched': query});
    e.preventDefault();
  });

  //Section Click
  $(document).on('click', '.view-all', function(e){
    doTracking('blog_section_click', {});
    e.preventDefault();
    var href = $(this).attr('href');
    window.open(href, '_blank');
  });
  
  $(document).on('click', '.ga-hompage-subcategory-inside-category-section', function(e){
    doTracking('blog_section_click', {});
    e.preventDefault();
    var href = $(this).attr('href');
    window.open(href, '_blank');
  });

  // Header Click
  $(document).on('click', '.bb-menu', function(e){
    var category_level = $(this).hasClass("ga-parent-category") ? 'l1' : 'l2';
    
    if(category_level == 'l2'){
      var category_l1 = $(this).attr("data-parent");
      var category_l2 = $(this).text();
      doTracking('blog_header_click', {'category_level': category_l1+":"+category_l2, 'category_l1': category_l1, 'category_l2': category_l2});
    }else{
      var category_l1 = $(this).text();
      doTracking('blog_header_click', {'category_level': category_l1, 'category_l1': category_l1});
    }
    var href = $(this).attr('href');
    window.open(href);
    e.preventDefault();
  });

});

function doTracking(title, param){
    if (typeof mixpanel !== "undefined" && (typeof title !== "undefined" || title != '')) {
      // Now you can call mixpanel.track() or other Mixpanel functions
      var token = $("data#mix-panel").attr('data-mixpanel-token');
      console.log(token);
      mixpanel.init(token);
      mixpanel.track(title, param);
      
      console.log(title);
      console.log(param);
    } else {
      // Mixpanel has not loaded yet, handle accordingly
      console.log("Mixpanel not loaded");
    }
}
